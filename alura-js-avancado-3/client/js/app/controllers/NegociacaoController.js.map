{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Binding","Mensagem","Negociacao","NegociacaoRepository","NegociacaoService","NegociacaoDao","MensagemView","NegociacoesView","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_negociacaoRepository","_mensagem","_ordenacaoAtual","_direcaoOrdenacao","buscarTodos","then","negociacoes","forEach","adicionar","neg","catch","texto","msgErro","setInterval","importarNegociacoes","event","preventDefault","value","parseInt","parseFloat","incluir","negociacao","_limparFormulario","service","obterTodasNegociacoes","filter","contains","length","erro","limpar","esvaziar","campo","ordenar","a","b","focus","controller","currentInstance"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import {Binding} from '../helpers/Binding';\nimport {Mensagem} from '../models/Mensagem';\nimport {Negociacao} from '../models/Negociacao';\nimport {NegociacaoRepository} from '../models/NegociacaoRepository';\nimport {NegociacaoService} from '../services/NegociacaoService';\nimport {NegociacaoDao} from '../dao/NegociacaoDao';\nimport {MensagemView} from '../views/MensagemView';\nimport {NegociacoesView} from '../views/NegociacoesView';\n\nclass NegociacaoController {\n    \n    constructor() {\n        let $ = document.querySelector.bind(document);\n        \n        this._inputData = $('#data');\n        this._inputQuantidade = $('#quantidade');\n        this._inputValor = $('#valor');\n        \n        this._negociacaoRepository = new Binding(\n            new NegociacaoRepository(),\n            new NegociacoesView($('#negociacoesView')),\n            'adicionar', 'esvaziar', 'ordenar'\n        );\n        this._mensagem = new Binding(\n            new Mensagem(),\n            new MensagemView($('#mensagemView')),\n            'texto'\n        );\n\n        this._ordenacaoAtual = '';\n        this._direcaoOrdenacao = 1;\n        \n        new NegociacaoDao().buscarTodos()\n            .then(negociacoes => negociacoes.forEach(neg => this._negociacaoRepository.adicionar(neg)))\n            .catch(msgErro => this._mensagem.texto = msgErro);\n    \n        setInterval(() => {\n            this.importarNegociacoes();\n        }, 20000);\n    }\n    \n    adicionarNegociacao(event) {\n        event.preventDefault();\n        \n        let neg = new Negociacao(this._inputData.value, parseInt(this._inputQuantidade.value), parseFloat(this._inputValor.value));\n        new NegociacaoDao().incluir(neg)\n            .then(negociacao => {\n                this._negociacaoRepository.adicionar(negociacao);\n                this._mensagem.texto = 'Negociação adicionada com sucesso';\n                this._limparFormulario();\n            })\n            .catch(msgErro => this._mensagem.texto = msgErro);\n    }\n    \n    importarNegociacoes(event) {\n        let service = new NegociacaoService();\n        service.obterTodasNegociacoes()\n            .then(negociacoes => negociacoes.filter(negociacao => !this._negociacaoRepository.contains(negociacao)))\n            .then(negociacoes => {\n                if (negociacoes.length > 0) {\n                    negociacoes.forEach(neg => this._negociacaoRepository.adicionar(neg));\n                    this._mensagem.texto = 'Negociações importadas com sucesso';\n                } else {\n                    this._mensagem.texto = 'Não existem negociações para serem importadas no momento';\n                }\n            })\n            .catch(erro => this._mensagem.texto = erro);\n    }\n    \n    limparNegociacoes(event) {\n        event.preventDefault();\n        \n        new NegociacaoDao().limpar()\n            .then(() => {\n                this._negociacaoRepository.esvaziar();\n                this._mensagem.texto = 'Negociações excluídas com sucesso';\n            })\n            .catch(msgErro => this._mensagem.texto = msgErro);\n        \n    }\n    \n    ordenarNegociacoes(campo) {\n        this._direcaoOrdenacao = (campo === this._ordenacaoAtual) ? -1 * this._direcaoOrdenacao : 1;\n        this._negociacaoRepository.ordenar((a,b) => (a[campo] - b[campo]) * this._direcaoOrdenacao);\n        this._ordenacaoAtual = campo;\n    }\n    \n    _limparFormulario() {\n        this._inputData.value = '';\n        this._inputQuantidade.value = '1';\n        this._inputValor.value = '0.0';\n        this._inputData.focus();\n    }\n}\n\nlet controller = new NegociacaoController();\n\nexport function currentInstance() {\n    return controller;\n}"]}